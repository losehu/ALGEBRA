#include <db-lib.h>

unsigned char sprite[3][32]={ // le sprite 16*16
0xff,0xff,0x1,0x80,0x5d,0x9a,0x51,0xa2,0x59,0x92,0xd1,0x8b,  // la couche 1
0x51,0xb2,0x1,0x80,0xff,0xff,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,

0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff, // la couche 2
0xff,0xff,0xff,0xff,0xff,0xff,0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,

0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,             // le masque
0x0,0x0,0x0,0x0,0x0,0x0,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff};

char bg[32]={
0xAA,0xAA,0x00,0x00,0xAA,0xAA,0x00,0x00,0xAA,0xAA,0x00,0x00,0xAA,0xAA,0x00,0x00,
0xAA,0xAA,0x00,0x00,0xAA,0xAA,0x00,0x00,0xAA,0xAA,0x00,0x00,0xAA,0xAA,0x00,0x00 };

void main()
{ int i,j;
  clear3(SEG1); // on efface les 3 premiers buffers
  mode(0xdb);   // on passe en mode db
  contrast(15); // on initialise le contraste a un niveau convenable pour du gris
  desactint9(); // on desactive l'interruption 9
  for(j=0;j<64;j+=16)
  for(i=0;i<128;i+=16)
  d16_or(i,j,bg,SEG1); // affiche l'arriere plan
  copyscreen(SEG1,SEG4); // on sauve l'arriere plan sur un autre buffer
  j=i=0;
  d16_and(i,j,sprite[2],SEG1); // on pose le masque du sprite sur les 2 buffers
  d16_and(i,j,sprite[2],SEG3);
  d16_or(i,j,sprite[0],SEG1);  // puis on affiche le sprite sur les 2 buffers
  d16_or(i,j,sprite[1],SEG3);

  do{ temps(100);  // on ralentit un peu le programme
      if (testkey(5,1) || testkey(4,7)) break; // ESC ou EXE quitte le programme
      if (testgroup(0x78,0x200)){
      if (testkey(1,9)) i--; // GAUCHE
      if (testkey(4,9)) i++; // DROITE
      if (testkey(2,9)) j--; // HAUT
      if (testkey(3,9)) j++; // BAS
      copyscreen(SEG4,SEG1); // on charge l'arriere plan
      copyscreen(SEG2,SEG3);
      d16_and(i,j,sprite[2],SEG1); // on pose le masque du sprite sur les 2 buffers
      d16_and(i,j,sprite[2],SEG3);
      d16_or(i,j,sprite[0],SEG1);  // puis on affiche le sprite sur les 2 buffers
      d16_or(i,j,sprite[1],SEG3);}

  }while (1);
  clear3(SEG1); // on initialise les parametres pour du mode c3
  contrast(8);
  mode(0xc3);
  actint9();}
